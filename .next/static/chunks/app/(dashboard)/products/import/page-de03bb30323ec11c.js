(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[913],{63:(e,t,s)=>{"use strict";var r=s(7260);s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},1490:(e,t,s)=>{Promise.resolve().then(s.bind(s,9188))},1786:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1847).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},2056:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1847).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},2383:()=>{},2529:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1847).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},3686:()=>{},4722:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1847).A)("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]])},6617:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1847).A)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]])},6648:(e,t,s)=>{"use strict";s.d(t,{U:()=>a});var r=s(5417);function a(){return(0,r.createBrowserClient)("https://oryknnnuwqabbvohybjd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9yeWtubm51d3FhYmJ2b2h5YmpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2MjMyMDUsImV4cCI6MjA4NjE5OTIwNX0.LrW7-z1_gu1SPtfUTlZs__W8T6aEm4sE1P6Q2353mnk")}},7937:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1847).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},8314:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1847).A)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]])},8874:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1847).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},9188:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>G});var r=s(5155),a=s(2115),n=s(63),i=s(5177),l=s(5899),o=s(1786),c=s(1847);let d=(0,c.A)("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]),m=(0,c.A)("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]]),u=(0,c.A)("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]),x=(0,c.A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var p=s(4269),h=s(5069);let g=[{number:1,title:"Upload",description:"Select Excel file",icon:o.A},{number:2,title:"Validate",description:"Review issues",icon:d},{number:3,title:"Categories",description:"Assign HSN & GST",icon:m},{number:4,title:"Import",description:"Review & commit",icon:u}];function f(e){let{currentStep:t}=e,{divisionCode:s}=(0,h.N)(),a={APT:{active:"border-apt-500 bg-apt-500/10 text-apt-500 ring-apt-500/20",completed:"border-apt-500 bg-apt-500 text-white",connector:"bg-apt-500"},HOSPI:{active:"border-hospi-500 bg-hospi-500/10 text-hospi-500 ring-hospi-500/20",completed:"border-hospi-500 bg-hospi-500 text-white",connector:"bg-hospi-500"}}[s];return(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between relative",children:[(0,r.jsx)("div",{className:"absolute top-6 left-0 right-0 h-0.5 bg-zinc-800",style:{marginLeft:"2rem",marginRight:"2rem"}}),(0,r.jsx)("div",{className:(0,p.cn)("absolute top-6 left-0 h-0.5 transition-all duration-500",a.connector),style:{marginLeft:"2rem",width:"calc(".concat((t-1)/(g.length-1)*100,"% - 2rem)")}}),g.map(e=>{let s=t>e.number,n=t===e.number,i=t<e.number,l=e.icon;return(0,r.jsxs)("div",{className:"flex flex-col items-center relative z-10",children:[(0,r.jsx)("div",{className:(0,p.cn)("w-12 h-12 rounded-full border-2 flex items-center justify-center transition-all",s&&a.completed,n&&(0,p.cn)(a.active,"ring-4"),i&&"border-zinc-700 bg-zinc-900 text-zinc-500"),children:s?(0,r.jsx)(x,{className:"w-5 h-5"}):(0,r.jsx)(l,{className:"w-5 h-5"})}),(0,r.jsxs)("div",{className:"mt-3 text-center",children:[(0,r.jsx)("p",{className:(0,p.cn)("text-sm font-medium",s||n?"text-foreground":"text-muted-foreground"),children:e.title}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5 hidden sm:block",children:e.description})]})]},e.number)})]})})}let b=(0,c.A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var j=s(4722);let v=(0,c.A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var N=s(2056),y=s(2529),w=s(4246);let _={SKU:0,NAME:1,CATEGORY:2,SPECS:3,UNIT:4,SELL_PRICE:5,LIST_PRICE:6,PROD_CLASS:7,CUSTOMIZABLE:8,PRINT_TYPE:9,MOQ:10,SLEEVE_QTY:11,BOX_QTY:12,STOCK_TYPE:13,WAREHOUSE:14,REMARKS:15},k=["PCS","KG","BOX","SET","PAIR","METER","ROLL"],S=["standard","custom_print","made_to_order"],C=["stocked","made_to_order"];function A(){let e=document.createElement("a");e.href="/templates/Product_Import_Template.xlsx",e.download="Product_Import_Template.xlsx",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function P(e){return null==e||""===e?"":String(e).trim().replace(/\r?\n+/g," - ")}function E(e){if(null==e||""===e)return null;let t=parseFloat(String(e).replace(/[₹Rs.\s,]/g,"").trim());return isNaN(t)?null:t}function z(e){if(null==e||""===e)return null;let t=parseInt(String(e).replace(/[,\s]/g,"").trim(),10);return isNaN(t)?null:t}function M(e){let{onFileParsed:t,parseFile:s,isLoading:n,error:i}=e,{divisionCode:c,currentDivision:d}=(0,h.N)(),m=(0,a.useRef)(null),[u,x]=(0,a.useState)(null),[g,f]=(0,a.useState)(!1),[w,_]=(0,a.useState)(!1),[k,S]=(0,a.useState)([]),C={APT:{accent:"text-apt-500",border:"border-apt-500",bg:"bg-apt-500/5"},HOSPI:{accent:"text-hospi-500",border:"border-hospi-500",bg:"bg-hospi-500/5"}}[c],P=(0,a.useCallback)(e=>{var t;if(e.size>0xa00000)return;let s=null==(t=e.name.split(".").pop())?void 0:t.toLowerCase();("xlsx"===s||"xls"===s||"csv"===s)&&(x(e),_(!1),S([]))},[]),E=(0,a.useCallback)(e=>{e.preventDefault(),f(!1);let t=e.dataTransfer.files[0];t&&P(t)},[P]),z=async()=>{if(u)try{let e=await s(u);S(e.slice(0,5)),_(!0),setTimeout(()=>{t(e,u.name)},800)}catch(e){}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:(0,p.cn)("rounded-lg border p-4 flex items-center justify-between",C.border,C.bg),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Importing to"}),(0,r.jsx)("p",{className:"font-semibold text-foreground",children:d.name})]}),(0,r.jsxs)(l.$n,{variant:"outline",size:"sm",className:"gap-2",onClick:A,children:[(0,r.jsx)(b,{className:"w-4 h-4"}),"Download Template"]})]}),(0,r.jsxs)("div",{onDragOver:e=>{e.preventDefault(),f(!0)},onDragLeave:()=>f(!1),onDrop:E,onClick:()=>{var e;return null==(e=m.current)?void 0:e.click()},className:(0,p.cn)("border-2 border-dashed rounded-xl p-12 text-center cursor-pointer transition-all group relative overflow-hidden",g?(0,p.cn)(C.border,C.bg):"border-zinc-700 hover:border-zinc-600 hover:bg-zinc-900/50",n&&"pointer-events-none opacity-50"),children:[(0,r.jsx)("input",{ref:m,type:"file",accept:".xlsx,.xls,.csv",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];s&&P(s)},className:"hidden"}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)("div",{className:(0,p.cn)("w-16 h-16 rounded-full flex items-center justify-center transition-colors",g?C.bg:"bg-zinc-800","group-hover:bg-zinc-700"),children:(0,r.jsx)(o.A,{className:(0,p.cn)("w-8 h-8 transition-colors",g?C.accent:"text-zinc-400 group-hover:text-zinc-300")})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-lg font-medium text-foreground",children:g?"Drop your Excel file here":"Drag & drop your Excel file"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"or click to browse. Supports .xlsx files up to 10 MB"})]})]})]}),u&&!w&&(0,r.jsxs)("div",{className:"bg-card border border-border rounded-lg p-4 animate-fade-in",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:(0,p.cn)("p-2 rounded-lg",C.bg),children:(0,r.jsx)(j.A,{className:(0,p.cn)("w-6 h-6",C.accent)})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-foreground",children:u.name}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(u.size/1024).toFixed(1)," KB"]})]})]}),(0,r.jsx)(l.$n,{variant:"ghost",size:"sm",onClick:()=>{x(null),_(!1),S([]),m.current&&(m.current.value="")},disabled:n,children:(0,r.jsx)(v,{className:"w-4 h-4"})})]}),i&&(0,r.jsxs)("div",{className:"mt-3 p-3 bg-red-500/10 border border-red-500/20 rounded-lg flex items-center gap-2 text-red-500",children:[(0,r.jsx)(N.A,{className:"w-4 h-4 flex-shrink-0"}),(0,r.jsx)("p",{className:"text-sm",children:i})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(l.$n,{onClick:z,isLoading:n,className:"w-full",children:n?"Parsing Excel file...":"Parse & Continue"})})]}),w&&(0,r.jsxs)("div",{className:"space-y-4 animate-fade-in",children:[(0,r.jsxs)("div",{className:"bg-emerald-500/10 border border-emerald-500/20 rounded-lg p-4 flex items-center gap-3",children:[(0,r.jsx)(y.A,{className:"w-6 h-6 text-emerald-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-emerald-500",children:"File parsed successfully!"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Proceeding to validation..."})]})]}),k.length>0&&(0,r.jsxs)("div",{className:"bg-card border border-border rounded-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"px-4 py-3 border-b border-border",children:(0,r.jsxs)("p",{className:"text-sm font-medium text-foreground",children:["Preview (first ",k.length," rows)"]})}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/50 border-b border-border",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2 text-left text-xs text-muted-foreground",children:"SKU"}),(0,r.jsx)("th",{className:"p-2 text-left text-xs text-muted-foreground",children:"Name"}),(0,r.jsx)("th",{className:"p-2 text-left text-xs text-muted-foreground",children:"Category"}),(0,r.jsx)("th",{className:"p-2 text-left text-xs text-muted-foreground",children:"Price"})]})}),(0,r.jsx)("tbody",{children:k.map(e=>(0,r.jsxs)("tr",{className:"border-b border-border",children:[(0,r.jsx)("td",{className:"p-2 font-mono text-zinc-300",children:e.sku||"-"}),(0,r.jsx)("td",{className:"p-2 text-foreground max-w-[200px] truncate",children:e.name}),(0,r.jsx)("td",{className:"p-2 text-muted-foreground",children:e.categoryName}),(0,r.jsx)("td",{className:"p-2 text-foreground",children:e.sellingPrice>0?"₹".concat(e.sellingPrice.toFixed(2)):"-"})]},e.rowNumber))})]})})]})]})]})}var I=s(8874);let T=(0,c.A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var R=s(4033),L=s(7937);function q(e){let{rows:t,summary:s,onContinue:n,onBack:i,onResolveConflict:o,isWritingStaging:c}=e,[d,m]=(0,a.useState)("all"),[u,x]=(0,a.useState)(new Set),h=(0,a.useMemo)(()=>"all"===d?t:t.filter(e=>e.validationStatus===d),[t,d]),g=s.error_count>0;return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[(0,r.jsx)(U,{icon:(0,r.jsx)(y.A,{className:"w-5 h-5 text-emerald-500"}),label:"Valid",value:s.valid_count,variant:"success"}),(0,r.jsx)(U,{icon:(0,r.jsx)(N.A,{className:"w-5 h-5 text-amber-500"}),label:"Warnings",value:s.warning_count,variant:"warning"}),(0,r.jsx)(U,{icon:(0,r.jsx)(I.A,{className:"w-5 h-5 text-red-500"}),label:"Errors",value:s.error_count,variant:"error"}),(0,r.jsx)(U,{icon:(0,r.jsx)(T,{className:"w-5 h-5 text-blue-500"}),label:"Auto SKUs",value:s.auto_generated_skus,variant:"info"}),(0,r.jsx)(U,{label:"Categories",value:s.categories_detected,variant:"default"}),(0,r.jsx)(U,{label:"Total Rows",value:s.total_rows,variant:"default"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 border-b border-border pb-3",children:[(0,r.jsx)(O,{active:"all"===d,onClick:()=>m("all"),label:"All",count:t.length}),(0,r.jsx)(O,{active:"valid"===d,onClick:()=>m("valid"),label:"Valid",count:s.valid_count,variant:"success"}),(0,r.jsx)(O,{active:"warning"===d,onClick:()=>m("warning"),label:"Warnings",count:s.warning_count,variant:"warning"}),(0,r.jsx)(O,{active:"error"===d,onClick:()=>m("error"),label:"Errors",count:s.error_count,variant:"error"})]}),(0,r.jsx)(l.Zp,{children:(0,r.jsx)(l.Wu,{className:"p-0",children:(0,r.jsx)("div",{className:"overflow-x-auto max-h-[500px] overflow-y-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/50 border-b border-border sticky top-0 z-10",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider w-10",children:"#"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Status"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"SKU"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Product Name"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Category"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Price"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Class"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Issues"})]})}),(0,r.jsx)("tbody",{children:h.map(e=>(0,r.jsxs)(a.Fragment,{children:[(0,r.jsxs)("tr",{className:(0,p.cn)("border-b border-border hover:bg-zinc-900/30 cursor-pointer transition-colors","error"===e.validationStatus&&"bg-red-500/5","warning"===e.validationStatus&&"bg-amber-500/5"),onClick:()=>e.validationMessages.length>0&&(e=>{let t=new Set(u);t.has(e)?t.delete(e):t.add(e),x(t)})(e.rowNumber),children:[(0,r.jsx)("td",{className:"p-3 text-sm text-muted-foreground",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[e.validationMessages.length>0&&(u.has(e.rowNumber)?(0,r.jsx)(R.A,{className:"w-3 h-3"}):(0,r.jsx)(L.A,{className:"w-3 h-3"})),e.rowNumber]})}),(0,r.jsx)("td",{className:"p-3",children:(0,r.jsx)(Z,{status:e.validationStatus})}),(0,r.jsx)("td",{className:"p-3 font-mono text-sm text-zinc-300",children:e.isAutoSku?(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[e.sku,(0,r.jsx)(l.Ex,{variant:"info",size:"sm",children:"Auto"})]}):e.sku}),(0,r.jsx)("td",{className:"p-3 text-sm text-foreground max-w-[200px] truncate",children:e.name}),(0,r.jsx)("td",{className:"p-3",children:(0,r.jsx)(l.Ex,{variant:"secondary",size:"sm",children:e.categoryName||"—"})}),(0,r.jsx)("td",{className:"p-3 text-sm text-foreground",children:e.sellingPrice>0?"₹".concat(e.sellingPrice.toFixed(2)):"—"}),(0,r.jsx)("td",{className:"p-3 text-sm text-muted-foreground",children:e.productClass||"—"}),(0,r.jsx)("td",{className:"p-3",children:e.validationMessages.length>0?(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:[e.validationMessages.length," issue(s)"]}):(0,r.jsx)(y.A,{className:"w-4 h-4 text-emerald-500"})})]}),u.has(e.rowNumber)&&e.validationMessages.length>0&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:8,className:"bg-zinc-900/50 p-4",children:(0,r.jsxs)("div",{className:"space-y-2",children:[e.validationMessages.map((e,t)=>(0,r.jsxs)("div",{className:(0,p.cn)("flex items-start gap-2 p-2 rounded-lg text-sm","error"===e.type&&"bg-red-500/10 text-red-400","warning"===e.type&&"bg-amber-500/10 text-amber-400","info"===e.type&&"bg-blue-500/10 text-blue-400"),children:["error"===e.type&&(0,r.jsx)(I.A,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),"warning"===e.type&&(0,r.jsx)(N.A,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),"info"===e.type&&(0,r.jsx)(y.A,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),(0,r.jsx)("span",{children:e.message}),(0,r.jsx)(l.Ex,{variant:"outline",size:"sm",className:"ml-auto",children:e.field})]},t)),"existing_product"===e.conflictType&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-border",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-foreground mb-2",children:"Resolution:"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(l.$n,{size:"sm",variant:"outline",onClick:t=>{t.stopPropagation(),o(e.rowNumber,"skip")},children:"Skip"}),(0,r.jsx)(l.$n,{size:"sm",variant:"outline",onClick:t=>{t.stopPropagation(),o(e.rowNumber,"overwrite")},children:"Overwrite"}),(0,r.jsx)(l.$n,{size:"sm",variant:"outline",onClick:t=>{t.stopPropagation(),o(e.rowNumber,"create_new")},children:"Create with Suffix"})]})]})]})})})]},e.rowNumber))})]})})})}),(0,r.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,r.jsx)(l.$n,{variant:"outline",onClick:i,children:"Back to Upload"}),(0,r.jsxs)("div",{className:"flex gap-3",children:[g&&(0,r.jsx)(l.$n,{variant:"outline",onClick:i,children:"Fix and Re-upload"}),(0,r.jsx)(l.$n,{onClick:n,isLoading:c,disabled:c,children:c?"Writing to staging...":g?"Proceed with ".concat(s.valid_count+s.warning_count," valid rows (skip ").concat(s.error_count," errors)"):"Continue to Categories"})]})]})]})}function U(e){let{icon:t,label:s,value:a,variant:n}=e;return(0,r.jsxs)("div",{className:(0,p.cn)("rounded-lg border p-3",{success:"border-emerald-500/30 bg-emerald-500/5",warning:"border-amber-500/30 bg-amber-500/5",error:"border-red-500/30 bg-red-500/5",info:"border-blue-500/30 bg-blue-500/5",default:"border-border bg-card"}[n]),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[t,(0,r.jsx)("span",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:s})]}),(0,r.jsx)("p",{className:"text-2xl font-bold text-foreground",children:a})]})}function O(e){let{active:t,onClick:s,label:a,count:n,variant:i}=e;return(0,r.jsxs)("button",{onClick:s,className:(0,p.cn)("px-4 py-2 text-sm font-medium rounded-lg transition-colors",t?"bg-secondary text-foreground":"text-muted-foreground hover:text-foreground hover:bg-secondary/50"),children:[a,(0,r.jsx)("span",{className:(0,p.cn)("ml-2 px-2 py-0.5 rounded-full text-xs","success"===i&&"bg-emerald-500/20 text-emerald-500","warning"===i&&"bg-amber-500/20 text-amber-500","error"===i&&"bg-red-500/20 text-red-500",!i&&"bg-zinc-700 text-zinc-400"),children:n})]})}function Z(e){let{status:t}=e,{icon:s,className:a}={valid:{icon:(0,r.jsx)(y.A,{className:"w-3.5 h-3.5"}),className:"bg-emerald-500/10 text-emerald-500 border-emerald-500/20"},warning:{icon:(0,r.jsx)(N.A,{className:"w-3.5 h-3.5"}),className:"bg-amber-500/10 text-amber-500 border-amber-500/20"},error:{icon:(0,r.jsx)(I.A,{className:"w-3.5 h-3.5"}),className:"bg-red-500/10 text-red-500 border-red-500/20"}}[t];return(0,r.jsxs)("span",{className:(0,p.cn)("inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border",a),children:[s,t.charAt(0).toUpperCase()+t.slice(1)]})}let F=(0,c.A)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var B=s(6651);let D=[{code:"3924",description:"Plastic tableware/kitchenware",gst:18},{code:"4823",description:"Paper/paperboard articles",gst:18},{code:"6912",description:"Ceramic tableware",gst:12},{code:"7013",description:"Glassware",gst:18},{code:"7323",description:"Steel/iron table articles",gst:18},{code:"7615",description:"Aluminium table articles",gst:18},{code:"3926",description:"Other plastic articles",gst:18},{code:"4819",description:"Paper boxes/bags",gst:18},{code:"4420",description:"Wood articles",gst:12},{code:"3923",description:"Plastic packing goods",gst:18},{code:"6911",description:"Porcelain/china tableware",gst:12}],W=[{value:"",label:"Select GST %"},{value:"5",label:"5%"},{value:"12",label:"12%"},{value:"18",label:"18%"},{value:"28",label:"28%"}];function $(e){let{categories:t,onUpdate:s,onContinue:n,onBack:i,isSaving:o}=e,{divisionCode:c}=(0,h.N)(),[d,u]=(0,a.useState)(""),[g,f]=(0,a.useState)(null),[b,j]=(0,a.useState)(!1),v={APT:{accent:"text-apt-500",bg:"bg-apt-500/10",border:"border-apt-500/30",fill:"bg-apt-500"},HOSPI:{accent:"text-hospi-500",bg:"bg-hospi-500/10",border:"border-hospi-500/30",fill:"bg-hospi-500"}}[c],N=t.filter(e=>e.category_name.toLowerCase().includes(d.toLowerCase())),y=t.filter(e=>e.hsn_code&&null!==e.gst_percent),w=t.length>0?Math.round(y.length/t.length*100):0,_=y.length===t.length,k=(e,r,a)=>{s(t.map(t=>t.category_name===e?{...t,[r]:a}:t))},S=(e,r)=>{s(t.map(t=>{var s;return{...t,hsn_code:t.hsn_code||e,gst_percent:null!=(s=t.gst_percent)?s:r}}))};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:(0,p.cn)("rounded-lg border p-4",v.border,v.bg),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(m,{className:(0,p.cn)("w-5 h-5",v.accent)}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-foreground",children:"Category & Tax Assignment"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Assign HSN codes and GST rates to each detected category"})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:"text-2xl font-bold text-foreground",children:[w,"%"]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[y.length," of ",t.length]})]})]}),(0,r.jsx)("div",{className:"w-full bg-zinc-800 rounded-full h-2",children:(0,r.jsx)("div",{className:(0,p.cn)("h-2 rounded-full transition-all",v.fill),style:{width:"".concat(w,"%")}})})]}),(0,r.jsx)(l.Zp,{children:(0,r.jsx)(l.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-foreground",children:"Quick Apply"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Apply common HSN & GST to unfilled categories"})]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsx)(l.$n,{variant:"outline",size:"sm",onClick:()=>S("4823",18),children:"Paper (4823, 18%)"}),(0,r.jsx)(l.$n,{variant:"outline",size:"sm",onClick:()=>S("3924",18),children:"Plastic (3924, 18%)"}),(0,r.jsx)(l.$n,{variant:"outline",size:"sm",onClick:()=>S("6912",12),children:"Ceramic (6912, 12%)"})]})]})})}),(0,r.jsxs)(l.Zp,{children:[(0,r.jsxs)("button",{className:"w-full p-4 flex items-center justify-between text-left",onClick:()=>j(!b),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(F,{className:"w-4 h-4 text-muted-foreground"}),(0,r.jsx)("span",{className:"text-sm font-medium text-foreground",children:"Common HSN Code Reference"})]}),b?(0,r.jsx)(R.A,{className:"w-4 h-4 text-muted-foreground"}):(0,r.jsx)(L.A,{className:"w-4 h-4 text-muted-foreground"})]}),b&&(0,r.jsx)(l.Wu,{className:"pt-0 pb-4",children:(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:D.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-zinc-900/50 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-mono text-foreground",children:e.code}),(0,r.jsx)("span",{className:"text-muted-foreground ml-2",children:e.description})]}),(0,r.jsxs)(l.Ex,{variant:"secondary",size:"sm",children:[e.gst,"%"]})]},e.code))})})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(B.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,r.jsx)(l.pd,{placeholder:"Search categories...",value:d,onChange:e=>u(e.target.value),className:"pl-10"})]}),(0,r.jsx)("div",{className:"space-y-3",children:N.map(e=>{var t,s;let a=!!(e.hsn_code&&null!==e.gst_percent),n=g===e.category_name;return(0,r.jsxs)(l.Zp,{className:"overflow-hidden",children:[(0,r.jsx)("button",{className:"w-full p-4 text-left hover:bg-zinc-900/30 transition-colors",onClick:()=>f(n?null:e.category_name),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:(0,p.cn)("w-2 h-2 rounded-full",a?"bg-emerald-500":"bg-amber-500")}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-foreground",children:e.category_name}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.product_count," products",e.is_new&&(0,r.jsx)(l.Ex,{variant:"info",size:"sm",className:"ml-2",children:"New"}),!e.is_new&&(0,r.jsx)(l.Ex,{variant:"secondary",size:"sm",className:"ml-2",children:"Existing"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[e.hsn_code&&(0,r.jsxs)(l.Ex,{variant:"secondary",size:"sm",children:["HSN: ",e.hsn_code]}),null!==e.gst_percent&&(0,r.jsxs)(l.Ex,{variant:"secondary",size:"sm",children:["GST: ",e.gst_percent,"%"]}),a&&(0,r.jsx)(x,{className:"w-5 h-5 text-emerald-500"})]})]})}),n&&(0,r.jsxs)("div",{className:"border-t border-border p-4 bg-zinc-900/30 space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-foreground mb-2",children:"HSN Code"}),(0,r.jsx)(l.pd,{placeholder:"e.g. 3924",value:e.hsn_code||"",onChange:t=>k(e.category_name,"hsn_code",t.target.value)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-foreground mb-2",children:"GST Rate"}),(0,r.jsx)(l.l6,{value:null!=(s=null==(t=e.gst_percent)?void 0:t.toString())?s:"",onChange:t=>k(e.category_name,"gst_percent",t.target.value?parseInt(t.target.value):null),options:W})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"Quick select:"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:D.map(t=>(0,r.jsxs)("button",{onClick:()=>{k(e.category_name,"hsn_code",t.code),k(e.category_name,"gst_percent",t.gst)},className:(0,p.cn)("px-3 py-1.5 rounded-lg text-xs transition-colors",e.hsn_code===t.code?(0,p.cn)(v.bg,v.accent,v.border,"border"):"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"),title:t.description,children:[t.code," (",t.gst,"%)"]},t.code))})]})]})]},e.category_name)})}),(0,r.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,r.jsx)(l.$n,{variant:"outline",onClick:i,children:"Back to Validation"}),(0,r.jsx)(l.$n,{onClick:n,disabled:!_||o,isLoading:o,children:o?"Saving categories...":_?"Continue to Review":"Assign tax info to ".concat(t.length-y.length," more")})]})]})}let H=(0,c.A)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var K=s(8314),Y=s(6617);function Q(e){let{rows:t,categories:s,summary:n,fileName:i,onCommit:o,onRollback:c,onBack:d,isCommitting:x,isRollingBack:g,commitSuccess:f,commitError:b}=e,{divisionCode:j,currentDivision:v}=(0,h.N)(),[w,_]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1),C=t.filter(e=>"error"!==e.validationStatus),A=s.filter(e=>e.is_new),P={APT:{accent:"text-apt-500",bg:"bg-apt-500",bgLight:"bg-apt-500/10",border:"border-apt-500/30"},HOSPI:{accent:"text-hospi-500",bg:"bg-hospi-500",bgLight:"bg-hospi-500/10",border:"border-hospi-500/30"}}[j];return f?(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"rounded-xl border border-emerald-500/30 bg-emerald-500/5 p-8 text-center",children:[(0,r.jsx)(y.A,{className:"w-16 h-16 text-emerald-500 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-foreground font-heading mb-2",children:"Import Complete!"}),(0,r.jsxs)("p",{className:"text-muted-foreground mb-6",children:["Successfully imported ",C.length," products into ",v.name]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 max-w-md mx-auto mb-8",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-emerald-500",children:C.length}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Products"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-foreground",children:s.length}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Categories"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-foreground",children:n.auto_generated_skus}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Auto SKUs"})]})]}),(0,r.jsxs)("div",{className:"flex justify-center gap-3",children:[(0,r.jsx)("a",{href:"/products",children:(0,r.jsxs)(l.$n,{className:"gap-2",children:["View Products ",(0,r.jsx)(H,{className:"w-4 h-4"})]})}),(0,r.jsxs)(l.$n,{variant:"danger",onClick:c,isLoading:g,className:"gap-2",children:[(0,r.jsx)(K.A,{className:"w-4 h-4"}),"Rollback Import"]})]})]})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:(0,p.cn)("rounded-xl border p-6",P.border,P.bgLight),children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:(0,p.cn)("p-3 rounded-lg",P.bg),children:(0,r.jsx)(u,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-foreground font-heading",children:"Ready to Import"}),(0,r.jsx)("p",{className:"text-muted-foreground mt-1",children:"Review the summary before committing to the database"})]})]}),(0,r.jsx)(l.Ex,{variant:"outline",children:v.name})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)(l.Zp,{children:[(0,r.jsx)(l.aR,{className:"pb-2",children:(0,r.jsx)(l.ZB,{className:"text-sm font-medium text-muted-foreground",children:"Source File"})}),(0,r.jsxs)(l.Wu,{children:[(0,r.jsx)("p",{className:"font-medium text-foreground truncate",children:i}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[n.total_rows," rows parsed"]})]})]}),(0,r.jsxs)(l.Zp,{children:[(0,r.jsx)(l.aR,{className:"pb-2",children:(0,r.jsxs)(l.ZB,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,r.jsx)(Y.A,{className:"w-4 h-4"})," Products to Import"]})}),(0,r.jsxs)(l.Wu,{children:[(0,r.jsx)("p",{className:"text-3xl font-bold text-foreground",children:C.length}),(0,r.jsxs)("div",{className:"flex items-center gap-3 mt-2",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1 text-sm text-emerald-500",children:[(0,r.jsx)(y.A,{className:"w-4 h-4"}),n.valid_count]}),(0,r.jsxs)("span",{className:"flex items-center gap-1 text-sm text-amber-500",children:[(0,r.jsx)(N.A,{className:"w-4 h-4"}),n.warning_count]})]})]})]}),(0,r.jsxs)(l.Zp,{children:[(0,r.jsx)(l.aR,{className:"pb-2",children:(0,r.jsxs)(l.ZB,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,r.jsx)(m,{className:"w-4 h-4"})," Categories"]})}),(0,r.jsxs)(l.Wu,{children:[(0,r.jsx)("p",{className:"text-3xl font-bold text-foreground",children:s.length}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:A.length>0?"".concat(A.length," new"):"All existing"})]})]})]}),(0,r.jsxs)(l.Zp,{children:[(0,r.jsx)(l.aR,{children:(0,r.jsx)(l.ZB,{children:"Categories & Tax Distribution"})}),(0,r.jsx)(l.Wu,{children:(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:s.map(e=>(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-zinc-900/50 border border-border",children:[(0,r.jsx)("p",{className:"font-medium text-foreground text-sm truncate",title:e.category_name,children:e.category_name}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,r.jsxs)("span",{className:"text-xs text-muted-foreground",children:[e.product_count," products"]}),(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)(l.Ex,{variant:"secondary",size:"sm",children:e.hsn_code}),(0,r.jsxs)(l.Ex,{variant:"secondary",size:"sm",children:[e.gst_percent,"%"]})]})]})]},e.category_name))})})]}),(0,r.jsxs)(l.Zp,{children:[(0,r.jsx)(l.aR,{children:(0,r.jsx)(l.ZB,{children:"Products Preview (First 10)"})}),(0,r.jsx)(l.Wu,{className:"p-0",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/50 border-b border-border",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase",children:"SKU"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase",children:"Name"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase",children:"Category"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase",children:"Price"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase",children:"HSN / GST"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-muted-foreground uppercase",children:"Class"})]})}),(0,r.jsx)("tbody",{children:C.slice(0,10).map(e=>{var t;let a=s.find(t=>t.category_name===e.categoryName);return(0,r.jsxs)("tr",{className:"border-b border-border",children:[(0,r.jsxs)("td",{className:"p-3 font-mono text-zinc-300",children:[e.sku,e.isAutoSku&&(0,r.jsx)(l.Ex,{variant:"info",size:"sm",className:"ml-1",children:"Auto"})]}),(0,r.jsx)("td",{className:"p-3 text-foreground max-w-[200px] truncate",children:e.name}),(0,r.jsx)("td",{className:"p-3",children:(0,r.jsx)(l.Ex,{variant:"secondary",size:"sm",children:e.categoryName})}),(0,r.jsxs)("td",{className:"p-3 text-foreground",children:["₹",e.sellingPrice.toFixed(2)]}),(0,r.jsxs)("td",{className:"p-3 text-muted-foreground",children:[(null==a?void 0:a.hsn_code)||"—"," / ",null!=(t=null==a?void 0:a.gst_percent)?t:"—","%"]}),(0,r.jsx)("td",{className:"p-3 text-muted-foreground",children:e.productClass})]},e.rowNumber)})})]})})})]}),b&&(0,r.jsxs)("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg flex items-center gap-3 text-red-500",children:[(0,r.jsx)(N.A,{className:"w-5 h-5 flex-shrink-0"}),(0,r.jsx)("p",{className:"text-sm",children:b})]}),(0,r.jsx)(l.Zp,{className:(0,p.cn)("border-2",w?P.border:"border-border"),children:(0,r.jsx)(l.Wu,{className:"p-4",children:(0,r.jsxs)("label",{className:"flex items-start gap-3 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:w,onChange:e=>_(e.target.checked),className:"mt-1 w-5 h-5 rounded border-border bg-secondary"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-foreground",children:"I confirm that I have reviewed all products and categories"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["This will import ",C.length," products into ",v.name,".",A.length>0&&" ".concat(A.length," new categories will be created.")," ","You can rollback this import if needed."]})]})]})})}),k&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,r.jsxs)(l.Zp,{className:"max-w-md w-full mx-4",children:[(0,r.jsx)(l.aR,{children:(0,r.jsx)(l.ZB,{children:"Confirm Import"})}),(0,r.jsxs)(l.Wu,{className:"space-y-4",children:[(0,r.jsxs)("p",{className:"text-muted-foreground",children:["You are about to import ",(0,r.jsxs)("strong",{className:"text-foreground",children:[C.length," products"]})," into"," ",(0,r.jsx)("strong",{className:"text-foreground",children:v.name}),".",A.length>0&&(0,r.jsxs)(r.Fragment,{children:[" This will create ",(0,r.jsxs)("strong",{className:"text-foreground",children:[A.length," new categories"]}),"."]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)(l.$n,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),(0,r.jsx)(l.$n,{variant:"success",isLoading:x,onClick:async()=>{await o(),S(!1)},children:"Confirm Import"})]})]})]})}),(0,r.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,r.jsx)(l.$n,{variant:"outline",onClick:d,children:"Back to Categories"}),(0,r.jsx)(l.$n,{variant:"success",onClick:()=>S(!0),disabled:!w||x,isLoading:x,className:"gap-2",children:x?"Importing...":"Commit Import"})]})]})}var V=s(6648);function G(){let e=(0,n.useRouter)(),{divisionCode:t,currentDivision:s}=(0,h.N)(),o=(0,V.U)(),[c,d]=(0,a.useState)(1),[m,u]=(0,a.useState)(!1),[x,p]=(0,a.useState)(null),[g,b]=(0,a.useState)(null),[j,v]=(0,a.useState)(null),[N,y]=(0,a.useState)([]),[A,I]=(0,a.useState)([]),[T,R]=(0,a.useState)(null),[L,U]=(0,a.useState)(!1),[O,Z]=(0,a.useState)(!1),[F,B]=(0,a.useState)(!1),[D,W]=(0,a.useState)(!1),[H,K]=(0,a.useState)(!1),[Y,G]=(0,a.useState)(null),X=(0,a.useCallback)(async()=>{var e;let{data:s}=await o.from("divisions").select("id").eq("code",t).single();return null!=(e=null==s?void 0:s.id)?e:null},[o,t]),J=(0,a.useCallback)(async e=>{u(!0),p(null);try{let t=await e.arrayBuffer(),s=function(e){let t=w.LF(e,{type:"array"}),s=t.SheetNames.includes("Products")?"Products":t.SheetNames[0],r=t.Sheets[s],a=w.Wp.sheet_to_json(r,{header:1,defval:null}),n=[];for(let e=2;e<a.length;e++){var i;let t=a[e];if(!t)continue;let s=function(e){if(null==e||""===e)return"";let t=String(e).trim();return t=t.replace(/\.0$/,""),/^\d+\.?\d*e\+?\d+$/i.test(t)&&(t=Number(t).toFixed(0)),t}(t[_.SKU]),r=P(t[_.NAME]);if(!s&&!r)continue;let l=E(t[_.SELL_PRICE]),o=E(t[_.LIST_PRICE]),c=P(t[_.CATEGORY]),d={};t.forEach((e,t)=>{d["col_".concat(t)]=e}),n.push({rowNumber:e+1,rawData:d,sku:s,barcode:s||null,name:r,categoryName:c?c.trim().toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"",specifications:P(t[_.SPECS])||null,unit:P(t[_.UNIT]).toUpperCase()||"PCS",sellingPrice:null!=l?l:0,listPrice:o,productClass:P(t[_.PROD_CLASS]).toLowerCase(),customizable:null!=(i=t[_.CUSTOMIZABLE])&&["yes","y","true","1"].includes(String(i).toLowerCase().trim()),printType:P(t[_.PRINT_TYPE])||null,moq:z(t[_.MOQ]),sleeveQty:z(t[_.SLEEVE_QTY]),boxQty:z(t[_.BOX_QTY]),stockType:P(t[_.STOCK_TYPE]).toLowerCase()||"stocked",warehouseZone:P(t[_.WAREHOUSE])||null,remarks:P(t[_.REMARKS])||null})}return n}(t);if(0===s.length)throw Error("No valid data rows found. Ensure data starts at row 3.");return s}catch(e){throw p(e instanceof Error?e.message:"Failed to parse Excel file"),e}finally{u(!1)}},[]),ee=(0,a.useCallback)(async(e,s)=>{b(s),u(!0),p(null);try{let s=await X();if(!s){p("Division not found in database"),u(!1);return}let{data:r}=await o.from("products").select("sku").eq("division_id",s),a=(r||[]).map(e=>e.sku),n=1,{data:i}=await o.from("products").select("sku").eq("division_id",s).eq("is_auto_sku",!0).order("sku",{ascending:!1}).limit(1);if(i&&i.length>0){let e=i[0].sku.match(/(\d+)$/);e&&(n=parseInt(e[1],10)+1)}let l=function(e,t,s,r){let a=new Set(t.map(e=>e.toLowerCase())),n=new Map;e.forEach((e,t)=>{if(e.sku){let s=e.sku.toLowerCase();n.has(s)||n.set(s,[]),n.get(s).push(t)}});let i=r;return e.map(t=>{let r=[],l=null,o=!1,c=t.sku;if(t.name||r.push({type:"error",field:"name",message:"Product name is required"}),t.categoryName||r.push({type:"error",field:"category",message:"Category is required"}),t.unit||r.push({type:"error",field:"unit",message:"Unit is required"}),t.sellingPrice<=0&&r.push({type:"error",field:"selling_price",message:"Selling price must be greater than 0"}),t.productClass||r.push({type:"error",field:"product_class",message:"Product class is required"}),t.sku||(c=function(e,t,s){if("HOSPI"===e){let e=t.toUpperCase().replace(/[^A-Z0-9]/g,"").substring(0,3)||"GEN";return"HOSPI-".concat(e,"-").concat(s.toString().padStart(4,"0"))}return"".concat(e,"-AUTO-").concat(s.toString().padStart(4,"0"))}(s,t.categoryName,i++),o=!0,r.push({type:"info",field:"sku",message:"Auto-generated SKU: ".concat(c)})),t.unit&&!k.includes(t.unit.toUpperCase())&&r.push({type:"error",field:"unit",message:'Invalid unit "'.concat(t.unit,'". Must be one of: ').concat(k.join(", "))}),t.productClass&&!S.includes(t.productClass)&&r.push({type:"error",field:"product_class",message:'Invalid product class "'.concat(t.productClass,'". Must be: standard, custom_print, or made_to_order')}),t.stockType&&!C.includes(t.stockType)&&r.push({type:"warning",field:"stock_type",message:'Invalid stock type "'.concat(t.stockType,'". Defaulting to "stocked"')}),null!==t.listPrice&&t.sellingPrice>0&&t.listPrice<t.sellingPrice&&r.push({type:"warning",field:"list_price",message:"List price (".concat(t.listPrice,") is less than selling price (").concat(t.sellingPrice,")")}),t.sku){let s=n.get(t.sku.toLowerCase());s&&s.length>1&&(r.push({type:"error",field:"sku",message:'Duplicate SKU "'.concat(t.sku,'" found in rows: ').concat(s.map(t=>e[t].rowNumber).join(", "))}),l="duplicate_in_file")}t.sku&&a.has(t.sku.toLowerCase())&&(r.push({type:"warning",field:"sku",message:'SKU "'.concat(t.sku,'" already exists in the database')}),l||(l="existing_product"));let d=r.some(e=>"error"===e.type),m=r.some(e=>"warning"===e.type);return{...t,sku:c,validationStatus:d?"error":m?"warning":"valid",validationMessages:r,conflictType:l,isAutoSku:o}})}(e,a,t,n);y(l);let c=l.filter(e=>"valid"===e.validationStatus).length,m=l.filter(e=>"warning"===e.validationStatus).length,x=l.filter(e=>"error"===e.validationStatus).length,h=l.filter(e=>e.isAutoSku).length,g=new Set(l.map(e=>e.categoryName).filter(Boolean));R({total_rows:l.length,valid_count:c,warning_count:m,error_count:x,categories_detected:g.size,auto_generated_skus:h}),d(2)}catch(e){console.error("Validation error:",e),p("Failed to validate data. Please try again.")}finally{u(!1)}},[t,o,X]),et=(0,a.useCallback)(async()=>{U(!0);try{var e,t,s,r;let a=await X();if(!a)throw Error("Division not found");let{data:n,error:i}=await o.from("import_batches").insert({division_id:a,file_name:g,total_rows:null!=(e=null==T?void 0:T.total_rows)?e:0,valid_count:null!=(t=null==T?void 0:T.valid_count)?t:0,warning_count:null!=(s=null==T?void 0:T.warning_count)?s:0,error_count:null!=(r=null==T?void 0:T.error_count)?r:0,status:"validating"}).select("id").single();if(i)throw Error("Failed to create batch: ".concat(i.message));v(n.id);let l=N.filter(e=>"error"!==e.validationStatus),c=l.map(e=>({import_batch_id:n.id,division_id:a,row_number:e.rowNumber,raw_data:e.rawData,parsed_sku:e.sku,parsed_barcode:e.barcode,parsed_name:e.name,parsed_category_name:e.categoryName,parsed_specifications:e.specifications,parsed_unit:e.unit,parsed_selling_price:e.sellingPrice,parsed_list_price:e.listPrice,parsed_product_class:e.productClass||"standard",parsed_customizable:e.customizable,parsed_print_type:e.printType,parsed_moq:e.moq,parsed_sleeve_qty:e.sleeveQty,parsed_box_qty:e.boxQty,parsed_stock_type:e.stockType||"stocked",parsed_warehouse_zone:e.warehouseZone,parsed_remarks:e.remarks,validation_status:e.validationStatus,validation_messages:e.validationMessages,conflict_type:e.conflictType,is_committed:!1}));for(let e=0;e<c.length;e+=500){let t=c.slice(e,e+500),{error:s}=await o.from("import_staging").insert(t);if(s)throw console.error("Staging insert error:",s.message),Error("Failed to write staging data: ".concat(s.message))}let m=new Map;l.forEach(e=>{e.categoryName&&m.set(e.categoryName,(m.get(e.categoryName)||0)+1)});let u=Array.from(m.keys()),{data:x}=await o.from("categories").select("id, name, hsn_code, gst_percent").eq("division_id",a).in("name",u),p=new Map((x||[]).map(e=>[e.name.toLowerCase(),e])),h=u.map(e=>{var t,s,r;let a=p.get(e.toLowerCase());return{category_name:e,product_count:m.get(e)||0,existing_category_id:null!=(t=null==a?void 0:a.id)?t:null,hsn_code:null!=(s=null==a?void 0:a.hsn_code)?s:"",gst_percent:null!=(r=null==a?void 0:a.gst_percent)?r:null,is_new:!a}});I(h),await o.from("import_batches").update({status:"reviewing"}).eq("id",n.id),d(3)}catch(e){console.error("Staging write error:",e)}finally{U(!1)}},[N,g,T,t,o,X]),es=(0,a.useCallback)(async()=>{Z(!0);try{if(!j)throw Error("No batch ID");if(!await X())throw Error("Division not found");for(let e of A){let{error:t}=await o.from("import_staging").update({assigned_hsn:e.hsn_code,assigned_gst_percent:e.gst_percent,assigned_category_id:e.existing_category_id}).eq("import_batch_id",j).eq("parsed_category_name",e.category_name);t&&console.error("Failed to update staging for ".concat(e.category_name,":"),t.message)}d(4)}catch(e){console.error("Category save error:",e)}finally{Z(!1)}},[A,j,o,X]),er=(0,a.useCallback)(async()=>{B(!0),G(null);try{if(!j)throw Error("No batch ID");let t=await X();if(!t)throw Error("Division not found");for(let s of A)if(s.is_new){let{data:r,error:a}=await o.from("categories").insert({division_id:t,name:s.category_name,hsn_code:s.hsn_code,gst_percent:s.gst_percent,sort_order:0}).select("id").single();if(a){var e;let{data:r}=await o.from("categories").select("id").eq("division_id",t).ilike("name",s.category_name).single();s.existing_category_id=null!=(e=null==r?void 0:r.id)?e:null}else s.existing_category_id=r.id}else s.existing_category_id&&await o.from("categories").update({hsn_code:s.hsn_code,gst_percent:s.gst_percent}).eq("id",s.existing_category_id);let s=new Map(A.map(e=>[e.category_name.toLowerCase(),e])),r=N.filter(e=>"error"!==e.validationStatus).map(e=>{var r;let a=s.get(e.categoryName.toLowerCase());return{division_id:t,category_id:(null==a?void 0:a.existing_category_id)||null,sku:e.sku,barcode:e.barcode,name:e.name,description:null,specifications:e.specifications,product_class:e.productClass||"standard",is_customizable:e.customizable,print_type:e.printType,parent_product_id:null,unit:e.unit||"PCS",moq:e.moq,sleeve_quantity:e.sleeveQty,box_quantity:e.boxQty,selling_price:e.sellingPrice,list_price:e.listPrice,hsn_code:(null==a?void 0:a.hsn_code)||null,gst_percent:null!=(r=null==a?void 0:a.gst_percent)?r:18,stock_type:e.stockType||"stocked",warehouse_zone:e.warehouseZone,marketplace_listed:!1,is_active:!0,is_auto_sku:e.isAutoSku,import_batch_id:j,import_notes:e.isAutoSku?"Auto-generated SKU. No barcode in source data.":e.remarks,source_row_number:e.rowNumber}});for(let e=0;e<r.length;e+=500){let t=r.slice(e,e+500),{error:s}=await o.from("products").insert(t);if(s)throw console.error("Product insert error:",s.message),Error("Failed to insert products (batch ".concat(Math.floor(e/500)+1,"): ").concat(s.message))}await o.from("import_staging").update({is_committed:!0}).eq("import_batch_id",j),await o.from("import_batches").update({status:"committed",committed_at:new Date().toISOString()}).eq("id",j),K(!0)}catch(e){G(e instanceof Error?e.message:"Failed to import products"),console.error("Commit error:",e)}finally{B(!1)}},[N,A,j,o,X]),ea=(0,a.useCallback)(async()=>{if(j){W(!0);try{let{error:t}=await o.from("products").delete().eq("import_batch_id",j);if(t)throw Error("Rollback failed: ".concat(t.message));await o.from("import_staging").update({is_committed:!1,committed_product_id:null}).eq("import_batch_id",j),await o.from("import_batches").update({status:"rolled_back"}).eq("id",j),e.push("/products")}catch(e){console.error("Rollback error:",e),G(e instanceof Error?e.message:"Rollback failed")}finally{W(!1)}}},[j,o,e]);return(0,r.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,r.jsx)(i.Y,{title:"Import Products"}),(0,r.jsxs)("div",{className:"p-6 max-w-6xl mx-auto",children:[(0,r.jsx)(f,{currentStep:c}),(0,r.jsx)(l.Zp,{className:"mt-6",children:(0,r.jsxs)(l.Wu,{className:"p-6",children:[1===c&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-foreground font-heading",children:"Upload Price List"}),(0,r.jsxs)("p",{className:"text-muted-foreground mt-1",children:["Upload your Excel template for ",s.name]})]}),(0,r.jsx)(M,{parseFile:J,onFileParsed:ee,isLoading:m,error:x})]}),2===c&&T&&(0,r.jsx)(q,{rows:N,summary:T,onContinue:et,onBack:()=>d(1),onResolveConflict:(e,t)=>{y(s=>s.map(s=>{if(s.rowNumber!==e)return s;let r={...s};if("skip"===t)r.validationStatus="error",r.validationMessages=[...r.validationMessages,{type:"info",field:"sku",message:"Marked to skip"}];else if("create_new"===t){let e="".concat(s.sku,"-NEW");r.sku=e,r.conflictType=null,r.validationMessages=r.validationMessages.filter(e=>!e.message.includes("already exists")),r.validationMessages.push({type:"info",field:"sku",message:"SKU changed to ".concat(e)}),r.validationStatus=r.validationMessages.some(e=>"error"===e.type)?"error":r.validationMessages.some(e=>"warning"===e.type)?"warning":"valid"}return r})),T&&R({...T,valid_count:N.filter(e=>"valid"===e.validationStatus).length,warning_count:N.filter(e=>"warning"===e.validationStatus).length,error_count:N.filter(e=>"error"===e.validationStatus).length})},isWritingStaging:L}),3===c&&(0,r.jsx)($,{categories:A,onUpdate:I,onContinue:es,onBack:()=>d(2),isSaving:O}),4===c&&T&&g&&(0,r.jsx)(Q,{rows:N.filter(e=>"error"!==e.validationStatus),categories:A,summary:T,fileName:g,onCommit:er,onRollback:ea,onBack:()=>d(3),isCommitting:F,isRollingBack:D,commitSuccess:H,commitError:Y})]})})]})]})}}},e=>{e.O(0,[524,453,819,755,441,255,358],()=>e(e.s=1490)),_N_E=e.O()}]);